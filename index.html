<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>i'm Vinzz</title>
  <style>
    :root{--bg:#0f172a;--card:#0b1220;--accent:#7c3aed;--muted:#94a3b8;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;margin:0;background:linear-gradient(180deg,#071029 0%,#07122a 100%);color:#e6eef8;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:100%;max-width:820px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border-radius:12px;padding:22px;box-shadow:0 6px 24px rgba(2,6,23,0.6)}
    h1{margin:0 0 6px;font-size:20px}
    p.lead{margin:0 0 18px;color:var(--muted)}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:inherit;margin-bottom:12px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .full{grid-column:1/-1}
    button{background:var(--accent);border:none;padding:10px 14px;border-radius:8px;color:white;font-weight:600;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    pre{background:#021027;padding:12px;border-radius:8px;overflow:auto;font-size:13px;white-space:pre-wrap}
    .result{margin-top:12px}
  </style>
</head>
<body>
  <main class="card">
    <h1>Create Panel</h1>
    <p class="lead">Create Panel Via Web By VinzzOfficial</p>

    <div class="grid">
      <div>
        <label>Username</label>
        <input id="username" type="text" placeholder="username">
      </div>
      <div>
        <label>RAM (MB)</label>
        <input id="ram" type="number" placeholder="contoh: 1024">
      </div>
    </div>

    <div class="full" style="display:flex;gap:10px;align-items:center">
      <button id="submit">Create Panel</button>
      <div class="muted">Status: <span id="status">idle</span></div>
    </div>

    <pre id="output" class="result"></pre>
  </main>

<script>
async function createUserAndServer() {
  const username = document.getElementById('username').value.trim();
  const ram = parseInt(document.getElementById('ram').value.trim(), 10);
  const statusEl = document.getElementById('status');
  const out = document.getElementById('output');

  if (!username || isNaN(ram)) {
    out.textContent = '❌ Semua field harus diisi dengan benar.';
    return;
  }
  if (ram < 512) {
    out.textContent = '⚠️ Minimal RAM adalah 512 MB.';
    return;
  }

  statusEl.textContent = 'Membuat user...';
  out.textContent = '';

  const LINK_LOG = "https://vinzz.zpr0.com";
  const API_BASE = "https://vinzz.zpr0.com/api/application";
  const API_KEY = "ptlc_YnJHBd4g6PwM0k39qwblLknz16UKGZcvctuVKm0aqWI";

  try {
    // === 1. BUAT USER (root_admin dipaksa false) ===
    const userPayload = {
      email: `${username}@vinzzofficial.com`,
      username: username,
      first_name: username,
      last_name: username,
      language: "en",
      password: `${username}011`,
      root_admin: false
    };

    // === 1. BUAT USER via Proxy ===
   const userRes = await fetch("https://ptero-proxy.vercel.app/api/create-user", {
     method: "POST",
     headers: {
     "Content-Type": "application/json"
     },
     body: JSON.stringify(userPayload)
    });

    const userData = await userRes.json();

    if (!userRes.ok) {
      out.textContent = "❌ User error ("+userRes.status+"): " + JSON.stringify(userData, null, 2);
      statusEl.textContent = '❌ Error';
      return;
    }

    const userId = userData.attributes.id;

    // === 2. AMBIL STARTUP EGG ===
    const eggRes = await fetch(`${API_BASE}/nests/5/eggs/15`, {
      headers: {
        "Accept": "application/json",
        "Authorization": `Bearer ${API_KEY}`
      }
    });

    const eggData = await eggRes.json();
    if (!eggRes.ok) {
      out.textContent = "❌ Egg error: " + JSON.stringify(eggData, null, 2);
      statusEl.textContent = '❌ Error';
      return;
    }
    const startup_cmd = eggData.attributes.startup;

    statusEl.textContent = 'Membuat server...';

    // === 3. BUAT SERVER ===
    const serverPayload = {
      name: username,
      user: userId,
      egg: 15,
      docker_image: "ghcr.io/parkervcp/yolks:nodejs_18",
      startup: startup_cmd,
      environment: {
        INST: "npm",
        USER_UPLOAD: "0",
        AUTO_UPDATE: "0",
        CMD_RUN: "npm start"
      },
      limits: { memory: ram, swap: 0, disk: ram, io: 500, cpu: 150 },
      feature_limits: { databases: 5, backups: 5, allocations: 1 },
      deploy: {
        locations: [1],
        dedicated_ip: false,
        port_range: [],
      },
    };

    const serverRes = await fetch(`${API_BASE}/servers`, {
      method: 'POST',
      headers: {
        "Accept": "application/json",
        "Content-Type": "application/json",
        "Authorization": `Bearer ${API_KEY}`
      },
      body: JSON.stringify(serverPayload)
    });

    const serverData = await serverRes.json();
    if (!serverRes.ok) {
      out.textContent = "❌ Server error: " + JSON.stringify(serverData, null, 2);
      statusEl.textContent = '❌ Error';
      return;
    }

    const succesResult = {
      user: username,
      password: `${username}011`,
      panel_url: LINK_LOG,
      root_admin: false
    };

    statusEl.textContent = '✅ Berhasil!';
    out.textContent = JSON.stringify(succesResult, null, 2);

  } catch (error) {
    statusEl.textContent = '❌ Error';
    out.textContent = error.message;
  }
}

document.getElementById('submit').addEventListener('click', createUserAndServer);
</script>
</body>
</html>
